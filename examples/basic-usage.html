<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Logger - Basic Usage Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 24px;
            margin: 8px 4px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #45a049;
        }
        button.error {
            background-color: #f44336;
        }
        button.error:hover {
            background-color: #da190b;
        }
        button.warn {
            background-color: #ff9800;
        }
        button.warn:hover {
            background-color: #e68900;
        }
        button.info {
            background-color: #2196F3;
        }
        button.info:hover {
            background-color: #0b7dda;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background-color: #f9f9f9;
            border-left: 4px solid #4CAF50;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .note {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Browser Logger - Usage Examples</h1>
        
        <div class="note">
            <strong>üìù Note:</strong> Open the browser console (F12) to see the logged messages!
        </div>

        <div class="section">
            <h2>1. Basic Logging</h2>
            <p>Click the buttons below to test different log levels:</p>
            <button onclick="testDebug()">Debug Log</button>
            <button onclick="testLog()">General Log</button>
            <button class="info" onclick="testInfo()">Info Log</button>
            <button class="warn" onclick="testWarn()">Warning Log</button>
            <button class="error" onclick="testError()">Error Log</button>
            <button class="error" onclick="testFatal()">Fatal Log</button>
        </div>

        <div class="section">
            <h2>2. Error Handling</h2>
            <p>Test automatic error catching (errors will appear in console - this is expected!):</p>
            <button class="error" onclick="triggerError()">Trigger Uncaught Error (Expected)</button>
            <button class="error" onclick="triggerPromiseRejection()">Trigger Promise Rejection (Expected)</button>
        </div>

        <div class="section">
            <h2>3. Try-Catch Wrapper</h2>
            <p>Test the tryCatch utility:</p>
            <button onclick="testTryCatchSuccess()">Successful Operation</button>
            <button class="error" onclick="testTryCatchError()">Failed Operation</button>
        </div>

        <div class="section">
            <h2>4. Manual Error Catching</h2>
            <p>Test manual error catching:</p>
            <button class="error" onclick="testCatcher()">Catch Custom Error</button>
        </div>

        <div class="section">
            <h2>5. üÜï v1.1.0 Advanced Features</h2>
            <p><strong>New in v1.1.0:</strong> Request batching, offline support, user tracking, advanced filtering, and security hooks!</p>
            <h3>Breadcrumb Tracking</h3>
            <button onclick="trackBreadcrumb()">Track User Breadcrumb</button>
            <p><small>Breadcrumbs track user interactions and appear in error logs</small></p>
            
            <h3>Offline Support</h3>
            <button onclick="getOfflineHistory()">View Stored Offline Logs</button>
            <button onclick="flushPendingLogs()">Flush Batched Logs Now</button>
            <p><small>Logs are automatically stored offline and synced when connection restored</small></p>
            
            <h3>Browser Context</h3>
            <button class="info" onclick="showBrowserInfo()">Show Browser Info</button>
            <p><small>Automatically captured: browser type, OS, screen resolution</small></p>
            
            <h3>Security & Privacy</h3>
            <button class="error" onclick="testSanitization()">Test PII Sanitization</button>
            <p><small>Credit cards, SSNs, and API keys are automatically redacted</small></p>
            
            <h3>Advanced Filtering</h3>
            <button onclick="testSampling()">Test Log Sampling</button>
            <p><small>Only a configured percentage of logs sent to reduce server load</small></p>
        </div>
    </div>

    <!-- Include the logger library -->
    <script src="../dist/clientside-Logger.js"></script>
    
    <script>
        // Initialize the logger with v1.1.0 features
        Logger.init({
            // Remote logging configuration
            logURL: 'https://your-api.example.com/logs',  // Replace with your logging endpoint
            logThreshold: 'ERROR',  // Only send ERROR and FATAL to remote server
            
            // Performance & Resource Management
            batchSize: 10,          // Batch logs before sending
            batchTimeout: 5000,     // Flush after 5 seconds
            requestTimeout: 10000,  // 10 second HTTP timeout
            useLocalStorage: true,  // Enable offline support
            
            // Data Collection & Context
            userId: 'user123',      // Track logs by user
            sessionId: 'sess-abc',  // Track by session
            environment: 'production',  // Environment context
            captureUserAgent: true,     // Auto-capture browser info
            captureScreenResolution: true,  // Capture screen size
            
            // Advanced Filtering & Control
            ignoredErrors: [/Script error/, /Chrome-extension/],  // Ignore patterns
            sampleRate: 1.0,  // Send 100% of logs (0.0-1.0)
            
            // Security & Privacy
            sanitize: true,  // Auto-sanitize PII
            beforeSend: (log) => {
                // Add custom field before sending
                log.appVersion = '1.0.0';
                return log;
            },
            afterSend: (log) => {
                console.log('Log sent:', log.logType);
            },
            
            // Display configuration
            showMessageInDevelopment: true,  // Show console messages in development
            showMessageInProduction: false,  // Hide console messages in production
            silenceStackTrace: false,        // Show stack traces
            additionalInformation: 'Example App v1.1.0'  // Additional context
        });

        console.log('‚úÖ Logger v1.1.0 initialized with advanced features!');

        // ============================================
        // v1.1.0 NEW FEATURES DEMONSTRATION
        // ============================================
        
        // Advanced: Add breadcrumbs for user interactions
        function trackBreadcrumb() {
            Logger.addBreadcrumb('User action tracked', { 
                action: 'navigation', 
                from: 'home',
                to: 'dashboard'
            });
            console.log('‚úÖ Breadcrumb added - will appear in next log');
        }

        // Advanced: Retrieve stored logs from offline cache
        function getOfflineHistory() {
            const storedLogs = Logger.getStoredLogs();
            console.log('üì¶ Offline stored logs:', storedLogs);
            alert('Stored ' + storedLogs.length + ' logs in localStorage');
        }

        // Advanced: Manual log flushing
        function flushPendingLogs() {
            Logger.flushLogs();
            console.log('üîÑ Pending batched logs flushed to server');
            alert('Batched logs sent to server immediately');
        }

        // Advanced: Get browser info captured by logger
        function showBrowserInfo() {
            const browserInfo = Logger.getBrowserInfo();
            console.log('üñ•Ô∏è Browser Info:', browserInfo);
            alert('Browser: ' + browserInfo.browser + '\nOS: ' + browserInfo.OS);
        }

        // Advanced: Demonstrate PII sanitization
        function testSanitization() {
            Logger.error('User credit card: 4532-1234-5678-9010 failed validation');
            Logger.error('SSN provided: 123-45-6789 for identity check');
            Logger.error('API Key leaked: sk_live_aBcDeFgHiJkLmNoPqRs exposed');
            console.log('‚úÖ Sensitive data automatically sanitized in logs');
        }

        // Advanced: Test sampling (only sends configured percentage)
        function testSampling() {
            for (let i = 0; i < 10; i++) {
                Logger.log('Sampled log #' + (i + 1) + ' (may not all be sent)');
            }
            console.log('‚úÖ 10 logs sent, but only sample rate % will reach server');
        }

        // Example 1: Basic Logging Functions
        function testDebug() {
            Logger.debug(['This is a debug message', { userId: 123, action: 'click' }]);
        }

        function testLog() {
            Logger.log(['General log message', 'Additional data']);
        }

        function testInfo() {
            Logger.info(['User performed an action', { timestamp: new Date().toISOString() }]);
        }

        function testWarn() {
            Logger.warn(['Warning: This feature is deprecated']);
        }

        function testError() {
            Logger.error({ 
                errorMessage: 'Something went wrong!', 
                stack: 'Error: at testError (example.html:123)' 
            });
        }

        function testFatal() {
            Logger.fatal({ 
                errorMessage: 'Critical system failure!', 
                stack: new Error().stack 
            });
        }

        // Example 2: Automatic Error Handling
        function triggerError() {
            // This will be automatically caught by the logger's error listener
            throw new Error('This is an intentional error for testing');
        }

        function triggerPromiseRejection() {
            // This will be caught by the unhandledrejection listener
            Promise.reject('Unhandled promise rejection for testing');
        }

        // Example 3: tryCatch Utility
        function testTryCatchSuccess() {
            Logger.tryCatch(
                () => {
                    console.log('‚úÖ Operation completed successfully!');
                    const result = 10 + 20;
                    console.log('Result:', result);
                },
                (error) => {
                    console.log('This should not run');
                }
            );
        }

        function testTryCatchError() {
            Logger.tryCatch(
                () => {
                    // This will throw an error
                    const obj = null;
                    console.log(obj.property);  // Will throw TypeError
                },
                (error) => {
                    console.log('‚úÖ Error was caught and handled:', error.message);
                    alert('Error caught: ' + error.message);
                }
            );
        }

        // Example 4: Manual Error Catching
        function testCatcher() {
            try {
                const data = JSON.parse('invalid json{');
            } catch (error) {
                Logger.catcher(error);
                alert('Error was logged: ' + error.message);
            }
        }

        // Example 5: Real-world usage in an application
        function fetchUserData(userId) {
            Logger.info(['Fetching user data', { userId }]);
            
            Logger.tryCatch(
                async () => {
                    const response = await fetch(`https://jsonplaceholder.typicode.com/users/${userId}`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    Logger.debug(['User data fetched successfully', data]);
                    console.log('User data:', data);
                },
                (error) => {
                    Logger.error({ 
                        errorMessage: `Failed to fetch user data: ${error.message}`,
                        stack: error.stack
                    });
                }
            );
        }

        // Demonstrate real-world usage
        console.log('\nüìö For a real-world example, run: fetchUserData(1)');
    </script>
</body>
</html>
